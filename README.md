# ai-agent-challenge
Coding agent challenge which write custom parsers for Bank statement PDF.

## Quick Start (5 Steps)

### 1. Clone and Setup
```bash
git clone <repository-url>
cd ai-agent-challenge
```

### 2. Install Dependencies
```bash
pip install -r requirements.txt
```

### 3. Configure Environment
```bash
# Create .env file with your Groq API key
echo "GROQ_API_KEY=your_groq_api_key_here" > .env
```

### 4. Run the Agent
```bash
# Generate parser for ICICI bank
python agent.py --target icici

# Or for any other bank with data in data/<bank_name>/ directory
python agent.py --target sbi
```

### 5. Test Generated Parser
```bash
# The agent automatically tests during execution
# Generated parser will be in custom_parsers/<bank_name>_parser.py
python -c "from custom_parsers.icici_parser import parse; print(parse('data/icici/icici sample.pdf'))"
```

## Agent Architecture

The BankParserAgent operates as an autonomous coding system using a **Plan → Generate → Test → Self-Correct** loop. The agent maintains state across multiple attempts (max 3) and uses LangGraph for workflow orchestration. It starts by analyzing both the target PDF structure and expected CSV output, then generates Python code using pdfplumber for extraction, tests the output against ground truth data, and iteratively self-corrects based on execution errors until achieving exact DataFrame matching or reaching maximum attempts.

## Agent Workflow Diagram

```
┌─────────────┐    ┌──────────────┐    ┌─────────────────┐
│    START    │────│     PLAN     │────│   ROUTE BASED   │
│             │    │   (decide    │    │   ON ACTION     │
└─────────────┘    │   action)    │    └─────────────────┘
                   └──────────────┘              │
                                                 ▼
              ┌──────────────┐           ┌─────────────┐
              │   ANALYZE    │◄──────────│   ACTION    │
              │ (PDF + CSV   │           │  ROUTING    │
              │  structure)  │           └─────────────┘
              └──────────────┘                   │
                      │                          │
                      ▼                          ▼
              ┌──────────────┐           ┌─────────────┐
              │   GENERATE   │           │   CORRECT   │
              │ (write parser│           │ (fix errors │
              │    code)     │           │  in code)   │
              └──────────────┘           └─────────────┘
                      │                          │
                      └─────────┐    ┌───────────┘
                               ▼    ▼
                        ┌──────────────┐
                        │     TEST     │
                        │ (run parser  │
                        │ & compare)   │
                        └──────────────┘
                               │
                        ┌──────▼──────┐
                        │   SUCCESS?  │
                        │  attempts<3 │
                        └─────────────┘
                         │           │
                    SUCCESS      CONTINUE/REFLECT
                         │           │
                        END    ┌─────▼─────┐
                               │  REFLECT  │
                               │ (analyze  │
                               │ failures) │
                               └───────────┘
                                     │
                                    END
```

## Project Structure

```
ai-agent-challenge/
├── agent.py              # CLI entry point
├── graph.py              # Main BankParserAgent class with LangGraph workflow
├── prompt.py             # LLM prompts for analysis, generation, and correction  
├── state.py              # AgentState TypedDict definition
├── requirements.txt      # Python dependencies
├── .env                  # API keys (create this)
├── data/                 # Bank statement samples
│   └── icici/
│       ├── icici sample.pdf
│       └── result.csv
└── custom_parsers/       # Generated parsers (created by agent)
    └── icici_parser.py   # Generated by agent
```

## Features

- **Autonomous Operation**: Runs completely hands-off with up to 3 self-correction attempts
- **Multi-Strategy Extraction**: Uses both table extraction and text parsing fallbacks
- **Robust Error Handling**: Handles malformed PDFs, missing data, and extraction failures
- **Exact Matching**: Validates output using `DataFrame.equals()` for precise comparison
- **Extensible**: Works with any bank by adding PDF/CSV pairs to `data/<bank_name>/`

## Technical Details

- **LLM Provider**: Groq (deepseek-r1-distill-llama-70b model)
- **PDF Processing**: pdfplumber (tables and text extraction)
- **Workflow Engine**: LangGraph for state management
- **Output Format**: pandas DataFrame matching provided CSV schema
- **Testing**: Automated comparison with expected results

## Requirements

- Python 3.8+
- Groq API key (free tier available)
- Dependencies listed in requirements.txt

## Adding New Banks

1. Create directory: `data/<bank_name>/`
2. Add files: `<bank_name> sample.pdf` and `result.csv`
3. Run: `python agent.py --target <bank_name>`

## Error Handling

The agent handles common PDF parsing challenges:
- Malformed or scanned PDFs
- Inconsistent table structures  
- Mixed text and table layouts
- Currency formatting variations
- Date format differences
